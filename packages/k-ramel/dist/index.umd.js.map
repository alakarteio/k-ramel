{"version":3,"file":"index.umd.js","sources":["../src/createStore/reduxFactory.js","../src/createStore/toContext.js","../src/createStore/combine.js","../src/createStore/enhanceRedux/getDevTools.js","../src/createStore/enhanceRedux/listenFactory.js","../src/createStore/enhanceRedux/enhanceRedux.js","../src/createStore/createStore.js","../src/factoryHelpers.js","../src/reaction.js"],"sourcesContent":["import factory from 'k-redux-factory'\n\nexport default (root) => {\n  const subtree = (name, path) => {\n    // first run\n    if (name === undefined) {\n      return Object\n        .keys(root)\n        .map(key => ({ [key]: subtree(key, '') }))\n        .reduce(\n          (acc, next) => ({ ...acc, ...next }),\n          {},\n        )\n    }\n\n    // other runs\n    const nextPath = `${path ? `${path}.` : ''}${name}`\n    const fullpath = `root.${nextPath}`\n    const options = eval(fullpath) // eslint-disable-line no-eval\n    const { type } = options\n\n    // - leaf\n    if (type) { // k-redux-factory\n      return factory({\n        name,\n        path,\n        prefix: (path && path.replace(/\\./g, '_')) || '',\n        ...options,\n      })\n    } else if (typeof options === 'function') { // custom reducer\n      return options\n    }\n\n    // - branch\n    return Object\n      .keys(options)\n      .map(key => ({ [key]: subtree(key, nextPath) }))\n      .reduce(\n        (acc, next) => ({ ...acc, ...next }),\n        {},\n      )\n  }\n\n  return subtree()\n}\n","const withParams = ['get', 'getBy', 'hasKey']\n\n// TODO: review this list with k-redux-factory 6.0.0\nconst keysConfig = {\n  keyValue: [\n    // actions\n    ['set', 'add', 'update', 'addOrUpdate', 'replace', 'remove', 'orderBy', 'reset'],\n    // selectors\n    ['get', 'getBy', 'getKeys', 'getAsArray', 'getLength', 'isInitialized', 'getState', 'hasKey'],\n  ],\n  simple: [\n    // actions\n    ['set', 'update', 'reset'],\n    // selectors\n    ['get', 'isInitialized'],\n  ],\n}\nkeysConfig.simpleObject = keysConfig.simple\nkeysConfig['simple.object'] = keysConfig.simple\nkeysConfig['simple.array'] = keysConfig.simple\nkeysConfig['simple.bool'] = keysConfig.simple\nkeysConfig['simple.string'] = keysConfig.simple\n\nexport default (root, store) => {\n  const subcontext = (name, path) => {\n    // first run\n    if (name === undefined) {\n      return Object\n        .keys(root)\n        .map(key => ({ [key]: subcontext(key, '') }))\n        .reduce(\n          (acc, next) => ({ ...acc, ...next }),\n          {},\n        )\n    }\n\n    // other runs\n    const nextPath = `${path ? `${path}.` : ''}${name}`\n    const fullpath = `root.${nextPath}`\n    const reducer = eval(fullpath) // eslint-disable-line no-eval\n\n    // - leaf\n    if (reducer.krfType !== undefined) {\n      const keys = keysConfig[reducer.krfType]\n      const [actions, selectors] = keys\n\n      const actionsObject = actions\n        .map((action) => {\n          const legacyAction = reducer[action]\n\n          return {\n            [action]: (...args) => store.dispatch(legacyAction(...args)),\n          }\n        })\n        .reduce(\n          (acc, next) => ({ ...acc, ...next }),\n          {},\n        )\n      const selectorsObject = selectors\n        .map((selector) => {\n          const legacySelector = reducer[selector]\n\n          return {\n            [selector]: (...args) => {\n              if (withParams.includes(selector)) return legacySelector(...args)(store.getState())\n              return legacySelector(store.getState())\n            },\n          }\n        })\n        .reduce(\n          (acc, next) => ({ ...acc, ...next }),\n          {},\n        )\n\n      return Object.assign(reducer, actionsObject, selectorsObject)\n    }\n\n    // - branch\n    return Object\n      .keys(reducer)\n      .map(key => ({ [key]: subcontext(key, nextPath) }))\n      .reduce(\n        (acc, next) => ({ ...acc, ...next }),\n        {},\n      )\n  }\n\n  return subcontext()\n}\n","import { combineReducers } from 'redux'\n\nexport default (root) => {\n  const subcombine = (current) => {\n    const reducers = Object\n      .keys(current)\n      .map((key) => {\n        const cur = current[key]\n        if (typeof cur === 'function') return ({ [key]: cur })\n        return ({ [key]: subcombine(cur) })\n      })\n      .reduce(\n        (acc, curr) => ({ ...acc, ...curr }),\n        {},\n      )\n\n    return combineReducers(reducers)\n  }\n\n  return subcombine(root)\n}\n","const getReduxDevToolsEnhancer = name => window.devToolsExtension({ name })\n\nexport default (options) => {\n  const { name, devtools } = options\n\n  // no devtool enable\n  if (!devtools || !window || !window.devToolsExtension) return undefined\n\n  // return enhancer with devtools\n  return getReduxDevToolsEnhancer(name)\n}\n","import { applyMiddleware } from 'redux'\n\nexport default (rootListeners = [], drivers, withDevTools) => {\n  // k-ramel store\n  let innerStore\n\n  // k-ramel listners\n  let innerListeners = [rootListeners]\n\n  return {\n    // this setter is needed since the middleware is pass to redux\n    // createStore, and then BEFORE, we have store instanciated\n    setStore: (store) => {\n      innerStore = store\n    },\n\n    // this is to add new listeners\n    addListeners: (listeners) => {\n      innerListeners = [...innerListeners, listeners]\n    },\n\n    // this is to remove listeners\n    removeListeners: (listeners) => {\n      innerListeners = innerListeners.filter(l => l !== listeners)\n    },\n\n    // redux middleware\n    enhancer: applyMiddleware(() => next => (action) => {\n      const innerAction = withDevTools ? (action.action || action) : action\n\n      // dispatch action\n      const res = next(action)\n\n      // trigger listeners\n      innerListeners\n        .forEach((listeners) => {\n          try {\n            listeners.forEach((listener) => {\n              listener(innerAction, innerStore, innerStore.drivers)\n            })\n          } catch (exception) {\n            innerStore.dispatch({\n              type: '@@krml/EXCEPTION',\n              payload: {\n                from: action,\n                exception,\n                message: exception.message,\n              },\n            })\n          }\n        })\n\n      // return action result\n      return res\n    }),\n  }\n}\n","import { compose } from 'redux'\nimport getDevTools from './getDevTools'\nimport listenFactory from './listenFactory'\n\n/* eslint-env browser */\nexport default (options) => {\n  const { listeners, drivers, enhancer } = options\n\n  // devtools\n  const devtools = getDevTools(options)\n\n  // add custom listeners extension\n  const listen = listenFactory(listeners, drivers, !!devtools)\n\n  const enhancers = [\n    enhancer,\n    devtools,\n    listen.enhancer,\n  ].filter(Boolean)\n\n  // add this middleware to enhancer\n  return { enhancer: compose(...enhancers), listen }\n}\n","import { createStore, compose } from 'redux'\nimport http from '@k-ramel/driver-http'\nimport reduxFactory from './reduxFactory'\nimport toContext from './toContext'\nimport combine from './combine'\nimport enhanceRedux from './enhanceRedux'\n\nconst defaultOptions = {\n  hideRedux: true,\n  enhancer: undefined,\n  init: {},\n  listeners: undefined,\n  devtools: true,\n  name: 'store',\n  drivers: {\n    http: http(),\n  },\n}\n\nexport default (definition, options = defaultOptions) => {\n  // options\n  const innerOptions = {\n    ...defaultOptions,\n    ...options,\n    drivers: {\n      ...defaultOptions.drivers,\n      ...options.drivers,\n    },\n  }\n  const { init, hideRedux, drivers } = innerOptions\n  const definitionWithDrivers = { ...definition }\n\n  // use drivers\n  const driversEnhancers = []\n  const driversInits = []\n  Object.values(drivers)\n    .forEach((driver) => {\n      // bind reducer to store definition\n      if (driver.getReducer) {\n        const { reducer, path } = driver.getReducer() // eslint-disable-line no-unused-vars\n        eval(`definitionWithDrivers${path.length > 0 ? '.' : ''}${path}=reducer`) // eslint-disable-line no-eval\n      }\n\n      // add enhancer\n      if (driver.getEnhancer) driversEnhancers.push(driver.getEnhancer())\n\n      // add init\n      if (driver.init) driversInits.push(driver.init)\n    })\n\n  // add all driver enhancers\n  if (innerOptions.enhancer) driversEnhancers.push(innerOptions.enhancer)\n  innerOptions.enhancer = compose(...driversEnhancers)\n\n  // this is reducer exports (action/selectors)\n  let reducerTree = reduxFactory(definitionWithDrivers)\n\n  // instanciate the listen middleware and prepare redux enhancers\n  const { enhancer, listen } = enhanceRedux(innerOptions)\n\n  // this is the redux store\n  const reduxStore = createStore(\n    combine(reducerTree),\n    init,\n    enhancer,\n  )\n\n  // convert to a contextualized version\n  if (hideRedux) {\n    reducerTree = toContext(reducerTree, reduxStore)\n  }\n\n  // store (our own)\n  const store = {\n    ...reducerTree,\n    ...reduxStore,\n    listeners: {\n      add: listen.addListeners,\n      remove: listen.removeListeners,\n    },\n  }\n\n  // store with driver\n  store.drivers = Object.keys(drivers)\n    .reduce(\n      (acc, driver) => ({ ...acc, [driver]: drivers[driver].getDriver(store) }),\n      {},\n    )\n\n  // custom dispatch\n  const reduxDispatch = store.dispatch\n  store.dispatch = (action, ...args) => {\n    if (typeof action === 'string') return reduxDispatch({ type: action })\n    return reduxDispatch(action, ...args)\n  }\n\n  // pass store to listen (after it has been created)\n  listen.setStore(store)\n\n  // init drivers\n  driversInits.forEach(driverInit => driverInit(store))\n\n  return store\n}\n","// TODO: documentation\nexport const types = {\n  array: params => ({ ...params, type: 'simple.array' }),\n  bool: params => ({ ...params, type: 'simple.bool' }),\n  string: params => ({ ...params, type: 'simple.string' }),\n  object: params => ({ ...params, type: 'simple.object' }),\n  keyValue: params => ({ ...params, type: 'keyValue' }),\n}\n\nexport const keyValue = (params) => {\n  console.warn('/k-ramel/ You are using a deprecated \"keyValue\" import. We recommend using `types` : types.object, types.array, types.bool, types.string or types.keyValue')\n  return { ...params, type: 'keyValue' }\n}\n\nexport const simpleObject = (params) => {\n  console.warn('/k-ramel/ You are using a deprecated \"simpleObject\" import. We recommend using `types` : types.object, types.array, types.bool, types.string or types.keyValue')\n\n  return { ...params, type: 'simple.object' }\n}\n","import { isRegExp, isString, isFunction } from 'lodash'\n\nconst isMatching = (action, store) => matcher => ( // test matching\n  // to a string\n  (\n    isString(matcher) &&\n    action.type === matcher\n  )\n  // to a function\n  || (\n    isFunction(matcher) &&\n    matcher(action, store)\n  )\n  // to a regexp\n  || (\n    isRegExp(matcher) &&\n    action.type.match(matcher)\n  )\n)\n\nexport const when = (...matchers) => callback => (action, store, drivers) => {\n  const match = matchers\n    .reduce((acc, curr) => acc && isMatching(action, store)(curr), true)\n\n  if (match) return callback(action, store, drivers)\n  return false\n}\n\nexport const reaction = fn => Object.assign(\n  fn,\n  { when: (...args) => when(...args)(fn) },\n)\n\nexport const reactions = fns => Object.keys(fns)\n  .reduce((acc, curr) => ({ ...acc, [curr]: reaction(fns[curr]) }), {})\n"],"names":["root","subtree","name","path","undefined","Object","keys","map","key","reduce","acc","next","nextPath","fullpath","options","eval","type","factory","prefix","replace","withParams","keysConfig","keyValue","simple","simpleObject","store","subcontext","reducer","krfType","actions","selectors","actionsObject","action","legacyAction","dispatch","selectorsObject","selector","legacySelector","includes","getState","assign","subcombine","current","reducers","cur","curr","combineReducers","getReduxDevToolsEnhancer","window","devToolsExtension","devtools","rootListeners","withDevTools","innerStore","innerListeners","setStore","addListeners","listeners","removeListeners","filter","l","enhancer","applyMiddleware","innerAction","res","forEach","listener","drivers","exception","payload","from","message","getDevTools","listen","listenFactory","enhancers","Boolean","compose","defaultOptions","hideRedux","init","http","definition","innerOptions","definitionWithDrivers","driversEnhancers","driversInits","values","driver","getReducer","length","getEnhancer","push","reducerTree","reduxFactory","enhanceRedux","reduxStore","createStore","combine","toContext","add","remove","getDriver","reduxDispatch","args","driverInit","types","array","params","bool","string","object","console","warn","isMatching","isString","matcher","isFunction","isRegExp","match","when","matchers","callback","reaction","fn","reactions","fns"],"mappings":"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"}