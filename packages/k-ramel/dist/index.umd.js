!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("redux"),require("k-redux-factory")):"function"==typeof define&&define.amd?define(["exports","redux","k-redux-factory"],n):n((e=e||self).kRamel={},e.Redux,e["k-redux-factory"])}(this,function(e,n,t){"use strict";function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(n){r(e,n,t[n])})}return e}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var c,u=e[Symbol.iterator]();!(r=(c=u.next()).done)&&(t.push(c.value),!n||t.length!==n);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=Object.freeze({array:function(e){return i({},e,{type:"simple.array"})},bool:function(e){return i({},e,{type:"simple.bool"})},string:function(e){return i({},e,{type:"simple.string"})},object:function(e){return i({},e,{type:"simple.object"})},number:function(e){return i({},e,{type:"simple.number"})},keyValue:function(e){return i({},e,{type:"keyValue"})}}),a=function(e,n){return n.split(".").reduce(function(e,n){return e&&e[n]},e)},f=["get","getBy","hasKey"],s={keyValue:[["set","add","update","addOrUpdate","remove"],["get","getBy","getKeys","getAsArray","getLength","isInitialized","getState","hasKey"]],simple:[["set","update"],["get","isInitialized"]]};s.simpleObject=s.simple,s["simple.object"]=s.simple,s["simple.array"]=s.simple,s["simple.bool"]=s.simple,s["simple.string"]=s.simple,s["simple.number"]=s.simple;var p="@@krml/RESET",d=function(e,n){return function(t,r){var i=function(e){return function(){return{type:p,payload:e}}}(r);if(e.hideRedux){var o=i;i=function(){return n(o())}}return t.reset=i,t.RESET=p,t}},l=function(e){return function e(t,o){var c=Object.keys(t).map(function(n){var i=t[n],c="".concat(o?"".concat(o,"."):"").concat(n);return r({},n,"function"==typeof i?function(e,n){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(r.type){case p:return n.startsWith(r.payload||"")?e(void 0,{}):t;default:return e(t,r)}}}(i,c):e(i,c))}).reduce(function(e,n){return i({},e,n)},{});return n.combineReducers(c)}(e,"")},y=function(e){var n=e.devtools;if(!1!==n&&(void 0!==n||"undefined"==typeof process||!process.env||"production"!==process.env.NODE_ENV))return function(e){if("undefined"!=typeof window){var n=e.name,t=e.trace,r=e.traceLimit;return window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__({name:n,trace:t,traceLimit:r}):void 0}}(e)},v=function(e){var t=e.listeners,r=e.drivers,i=e.enhancer,o=y(e),u=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>2?arguments[2]:void 0,i=[t];return{setStore:function(n){e=n},addListeners:function(e){i=[].concat(c(i),[e])},removeListeners:function(e){i=i.filter(function(n){return n!==e})},enhancer:n.applyMiddleware(function(){return function(n){return function(t){var o=r&&t.action||t,c=n(t);return i.forEach(function(n){try{n.forEach(function(n){n(o,e,e.drivers)})}catch(n){e.dispatch({type:"@@krml/EXCEPTION",payload:{from:t,exception:n,message:n.message}})}}),c}}})}}(t,r,!!o),a=[i,o,u.enhancer].filter(Boolean);return{enhancer:n.compose.apply(void 0,c(a)),listen:u}},m={hideRedux:!0,enhancer:void 0,init:{},listeners:void 0,devtools:void 0,trace:!1,traceLimit:25,name:"store",drivers:{}},h=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(e){return function(t,r,i){return!!n.reduce(function(e,n){return e&&function(e,n){return function(t){return("string"==typeof t||t instanceof String)&&e.type===t||("function"==typeof t||t instanceof Function)&&t(e,n)||t instanceof RegExp&&e.type.match(t)}}(t,r)(n)},!0)&&e(t,r,i)}}},g=function(e){return Object.assign(e,{when:function(){return h.apply(void 0,arguments)(e)}})};Object.defineProperty(e,"applyMiddleware",{enumerable:!0,get:function(){return n.applyMiddleware}}),Object.defineProperty(e,"compose",{enumerable:!0,get:function(){return n.compose}}),e.createStore=function(e){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,u=i({},m,c,{drivers:i({},m.drivers,c.drivers)}),p=u.init,y=u.hideRedux,h=u.drivers,g=i({},e),b=[],O=[];Object.values(h).forEach(function(e){if(e.getReducer){var n=e.getReducer(),t=n.reducer,r=n.path;if(r.length)for(var i=r.split("."),o=g,c=0;c<i.length;c+=1){var u=i[c];if(c===i.length-1){o[u]=t;break}o[u]||(o[u]={}),o=o[u]}}e.getEnhancer&&b.push(e.getEnhancer()),e.init&&O.push(e.init)}),u.enhancer&&b.push(u.enhancer),u.enhancer=n.compose.apply(void 0,b);var E,j=(E=g,function e(n,o){if(void 0===n)return Object.keys(E).map(function(n){return r({},n,e(n,""))}).reduce(function(e,n){return i({},e,n)},{});var c="".concat(o?"".concat(o,"."):"").concat(n),u=a(E,c);return u.type?t.factory(i({name:n,path:o,prefix:o&&o.replace(/\./g,"_")||""},u)):"function"==typeof u?u:Object.keys(u).map(function(n){return r({},n,e(n,c))}).reduce(function(e,n){return i({},e,n)},{})}()),k=v(u),w=k.enhancer,S=k.listen,x=n.createStore(l(j),p,w);j=function(e){return function(n,t){var r=d(e,t.dispatch);return function e(t,i){if(void 0!==t){var o="".concat(i?"".concat(i,"."):"").concat(t),c=a(n,o);"function"!=typeof c&&"RESET"!==t&&Object.keys(c).forEach(function(n){e(n,o)}),r(c,o)}else Object.keys(n).forEach(function(n){e(n,"")})}(),r(n)}}(u)(j,x),y&&(j=function(e,n){return function t(c,u){if(void 0===c)return Object.keys(e).map(function(e){return r({},e,t(e,""))}).reduce(function(e,n){return i({},e,n)},{});var p="".concat(u?"".concat(u,"."):"").concat(c),d=a(e,p);if("RESET"===c)return d;if("function"==typeof d&&void 0===d.krfType)return d;if(void 0!==d.krfType){var l=o(s[d.krfType],2),y=l[0],v=l[1],m=y.map(function(e){var t=d[e];return r({},e,function(){return n.dispatch(t.apply(void 0,arguments))})}).reduce(function(e,n){return i({},e,n)},{}),h=v.map(function(e){var t=d[e];return r({},e,function(){return f.includes(e)?t.apply(void 0,arguments)(n.getState()):t(n.getState())})}).reduce(function(e,n){return i({},e,n)},{});return Object.assign(d,m,h)}return Object.keys(d).map(function(e){return r({},e,t(e,p))}).reduce(function(e,n){return i({},e,n)},{})}()}(j,x));var _=i({},j,x,{listeners:{add:S.addListeners,remove:S.removeListeners}});_.drivers=Object.keys(h).reduce(function(e,n){return i({},e,r({},n,h[n].getDriver(_)))},{});var R=_.dispatch;return _.dispatch=function(e){if("string"==typeof e)return R({type:e});for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return R.apply(void 0,[e].concat(t))},S.setStore(_),_.dispatch("@@krml/INIT"),O.forEach(function(e){return e(_)}),_},e.reaction=g,e.reactions=function(e){return Object.keys(e).reduce(function(n,t){return i({},n,r({},t,g(e[t])))},{})},e.types=u,e.when=h,Object.defineProperty(e,"__esModule",{value:!0})});
