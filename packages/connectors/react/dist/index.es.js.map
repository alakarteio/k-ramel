{"version":3,"file":"index.es.js","sources":["../src/getWrappedDisplayName.js","../src/createContext.js","../src/inject.jsx","../src/provider.jsx","../src/listen.jsx"],"sourcesContent":["export default Component => (\n  Component.displayName\n  || Component.name\n  || (Component.constructor && Component.constructor.name)\n  || 'Unknown'\n)\n","import { createContext } from 'react'\n\n// this is a singleton :(\nlet context\n\nexport default () => {\n  if (!context) context = createContext()\n  return context\n}\n","import React from 'react'\nimport shallowEqual from 'fbjs/lib/shallowEqual'\nimport getWrappedDisplayName from './getWrappedDisplayName'\nimport createContext from './createContext'\n\nconst defaultObject = {}\n\nconst withoutFunctions = object => Object\n  .keys(object)\n  .reduce(\n    (acc, key) => {\n      const value = object[key]\n      if (typeof value === 'function') return acc\n      return { ...acc, [key]: value }\n    },\n    defaultObject,\n  )\n\nconst getDerivedStateFromProps = injectFunction => (nextProps, prevState) => {\n  const { store } = prevState\n\n  // get props derivated from redux state\n  const injectedProps = injectFunction(store, nextProps.ownProps, store.drivers)\n\n  // no modifications ?\n  if (\n    shallowEqual(\n      withoutFunctions(prevState.injectedProps),\n      withoutFunctions(injectedProps),\n    )\n  ) return null\n\n  return { ...prevState, injectedProps, state: store.getState() }\n}\n\nconst wrapper = injectFunction => Component => class extends React.Component {\n  static displayName = `inject(${getWrappedDisplayName(Component)})`\n\n  static getDerivedStateFromProps = getDerivedStateFromProps(injectFunction)\n\n  static propTypes = {\n    store: () => null,\n  }\n\n  static defaultProps = {\n    store: undefined,\n  }\n\n  constructor(props) {\n    super(props)\n\n    const { store } = props\n\n    if (!store) {\n      const bold = 'font-weight: bolder; font-style: italic;'\n      // eslint-disable-next-line no-console\n      console.error(\n        `[k-ramel/react] Error in %cinject%c for the component %c${getWrappedDisplayName(Component)}%c\\n` +\n        '\\t> The store needs to be provided by an ancestor of this component.\\n' +\n        '\\t> You can use %cprovider%c from %c@k-ramel/react%c or %cProvider%c from %creact-redux%c.\\n\\n' +\n        'Check the documentation for an example at https://github.com/alakarteio/k-ramel#connect-it-with-reactjs\\n',\n        bold, '', bold, '', bold, '', bold, '', bold, '', bold, '',\n      )\n      return\n    }\n\n    this.state = getDerivedStateFromProps(injectFunction)(\n      this.props,\n      {\n        // needed for first call (where we shallow compare old and new one)\n        injectedProps: defaultObject,\n        // store needed to call injectFunction\n        store,\n      },\n    )\n  }\n\n  componentDidMount() {\n    const { store } = this.props\n\n    if (!store) {\n      const bold = 'font-weight: bolder; font-style: italic;'\n      // eslint-disable-next-line no-console\n      console.error(\n        `[k-ramel/react] Error in %cinject%c for the component %c${getWrappedDisplayName(Component)}%c\\n` +\n        '\\t> The store needs to be provided by an ancestor of this component.\\n' +\n        '\\t> You can use %cprovider%c from %c@k-ramel/react%c or %cProvider%c from %creact-redux%c.\\n\\n' +\n        'Check the documentation for an example at https://github.com/alakarteio/k-ramel#connect-it-with-reactjs\\n',\n        bold, '', bold, '', bold, '', bold, '', bold, '', bold, '',\n      )\n      return\n    }\n\n    this.unsubscribe = store.subscribe(() => {\n      if (this.state.state !== store.getState()) {\n        const newState = getDerivedStateFromProps(injectFunction)(this.props, this.state)\n\n        if (newState !== null) this.setState(newState)\n      }\n    })\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe()\n  }\n\n  render() {\n    const { ownProps, injectedProps } = this.state\n\n    return (\n      <Component\n        {...ownProps}\n        {...injectedProps}\n      />\n    )\n  }\n}\n\nexport default (injectFunction) => {\n  const { Consumer } = createContext()\n  const withInjectFunction = wrapper(injectFunction)\n\n  return (Component) => {\n    const WrappedComponent = withInjectFunction(Component)\n\n    const WithConsumer = props => (\n      <Consumer>\n        {store => <WrappedComponent ownProps={props} store={store} />}\n      </Consumer>\n    )\n\n    WithConsumer.displayName = `consumer(${getWrappedDisplayName(WrappedComponent)})`\n\n    return WithConsumer\n  }\n}\n","/* eslint-disable import/prefer-default-export */\nimport React, { Component } from 'react'\nimport getWrappedDisplayName from './getWrappedDisplayName'\nimport createContext from './createContext'\n\nexport default (store) => {\n  const { Provider } = createContext()\n\n  return WrappedComponent => class extends Component {\n    static displayName = `provider(${getWrappedDisplayName(WrappedComponent)})`\n\n    componentWillMount() {\n      store.dispatch('@@krml/INIT')\n    }\n\n    render() {\n      return (\n        <Provider value={store}>\n          <WrappedComponent {...this.props} />\n        </Provider>\n      )\n    }\n  }\n}\n","import React from 'react'\nimport createContext from './createContext'\nimport getWrappedDisplayName from './getWrappedDisplayName'\n\nconst defaultListeners = []\n\nconst toActionFactory = (name) => {\n  const suffix = `${name ? '>' : ''}${name || ''}`\n  return type => `@@krml/LISTENERS>${type}${suffix}`\n}\n\nconst defaultObject = {}\n\nconst wrapper = (listeners, name) => (Component) => {\n  const toAction = toActionFactory(name)\n\n  return class extends React.Component {\n    static displayName = `listen(${getWrappedDisplayName(Component)})`\n\n    static propTypes = {\n      store: () => null,\n      ownProps: () => null,\n    }\n\n    static defaultProps = {\n      store: undefined,\n      ownProps: defaultObject,\n    }\n\n    componentDidMount() {\n      const { store } = this.props\n\n      if (!store) {\n        const bold = 'font-weight: bolder; font-style: italic;'\n        // eslint-disable-next-line no-console\n        console.error(\n          `[k-ramel/react] Error in %clisten%c for the component %c${getWrappedDisplayName(Component)}%c\\n` +\n          '\\t> The store needs to be provided by an ancestor of this component.\\n' +\n          '\\t> You can use %cprovider%c from %c@k-ramel/react%c or %cProvider%c from %creact-redux%c.\\n\\n' +\n          'Check the documentation for an example at https://github.com/alakarteio/k-ramel#connect-it-with-reactjs\\n',\n          bold, '', bold, '', bold, '', bold, '', bold, '', bold, '',\n        )\n        return\n      }\n\n      store.listeners.add(listeners)\n      store.dispatch(toAction('ADDED'))\n    }\n\n    componentWillUnmount() {\n      const { store } = this.props\n\n      store.dispatch(toAction('REMOVING'))\n      store.listeners.remove(listeners)\n    }\n\n    render() {\n      return <Component {...this.props.ownProps} />\n    }\n  }\n}\n\nexport default (listeners = defaultListeners, name) => {\n  const { Consumer } = createContext()\n\n  const withListeners = wrapper(listeners, name)\n\n  return (Component) => {\n    const WrappedComponent = withListeners(Component)\n\n    const WithConsumer = props => (\n      <Consumer>\n        {store => <WrappedComponent ownProps={props} store={store} />}\n      </Consumer>\n    )\n\n    WithConsumer.displayName = `consumer(${getWrappedDisplayName(WrappedComponent)})`\n\n    return WithConsumer\n  }\n}\n"],"names":["Component","displayName","name","constructor","context","createContext","defaultObject","withoutFunctions","Object","keys","object","reduce","acc","key","value","getDerivedStateFromProps","nextProps","prevState","store","injectedProps","injectFunction","ownProps","drivers","shallowEqual","state","getState","wrapper","props","bold","error","getWrappedDisplayName","_this","this","unsubscribe","subscribe","_this2","newState","setState","React","propTypes","defaultProps","undefined","Consumer","withInjectFunction","WrappedComponent","WithConsumer","Provider","dispatch","defaultListeners","toActionFactory","suffix","type","listeners","toAction","add","remove","withListeners"],"mappings":"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"}