{"version":3,"file":"index.umd.js","sources":["../src/getWrappedDisplayName.js","../src/inject.jsx","../src/provider.jsx","../src/listen.jsx"],"sourcesContent":["export default Component => (\n  Component.displayName\n  || Component.name\n  || (Component.constructor && Component.constructor.name)\n  || 'Unknown'\n)\n","import React, { Component } from 'react'\nimport shallowEqual from 'fbjs/lib/shallowEqual'\nimport getWrappedDisplayName from './getWrappedDisplayName'\n\nconst defaultObject = {}\nconst withoutFunctions = object => Object\n  .keys(object)\n  .reduce(\n    (acc, key) => {\n      const value = object[key]\n      if (typeof value === 'function') return acc\n      return { ...acc, [key]: value }\n    },\n    defaultObject,\n  )\n\nexport default injectFunction => WrappedComponent => class extends Component {\n  static displayName = `inject(${getWrappedDisplayName(WrappedComponent)}`\n\n  static contextTypes = {\n    store: () => null, // this is to avoid importing prop-types\n  }\n\n  constructor(props, context) {\n    super(props, context)\n\n    this.first = true\n    this.state = {\n      injectedProps: {},\n    }\n  }\n\n  componentWillMount() {\n    const { store } = this.context\n\n    if (!store) {\n      const bold = 'font-weight: bolder; font-style: italic;'\n      // eslint-disable-next-line no-console\n      console.error(\n        `[k-ramel/react] Error in %cinject%c for the component %c${getWrappedDisplayName(WrappedComponent)}%c\\n` +\n        '\\t> The store needs to be provided by an ancestor of this component.\\n' +\n        '\\t> You can use %cprovider%c from %c@k-ramel/react%c or %cProvider%c from %creact-redux%c.\\n\\n' +\n        'Check the documentation for an example at https://github.com/alakarteio/k-ramel#connect-it-with-reactjs\\n',\n        bold, '', bold, '', bold, '', bold, '', bold, '', bold, '',\n      )\n      return\n    }\n    this.store = store\n\n    // run in once\n    this.inject()\n\n    // subscribe\n    this.unsubscribe = store.subscribe(() => { this.inject() })\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.inject(nextProps)\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    if (this.first) return true\n\n    return !(\n      shallowEqual(this.props, nextProps)\n      && shallowEqual(\n        withoutFunctions(nextState.injectedProps),\n        withoutFunctions(this.state.injectedProps),\n      )\n    )\n  }\n\n  componentWillUnmount() {\n    this.store = undefined\n    this.unsubscribe()\n  }\n\n  inject = (nextProps) => {\n    if (!this.store) return\n\n    this.setState(state => ({\n      ...state,\n      injectedProps: injectFunction\n        ? injectFunction(this.store, nextProps || this.props, this.store.drivers) || defaultObject\n        : defaultObject,\n    }))\n  }\n\n  render() {\n    if (this.first) this.first = false\n\n    return (\n      <WrappedComponent\n        /* this is parent props */\n        {...this.props}\n        /* this is injected props from hoc */\n        {...this.state.injectedProps}\n      />\n    )\n  }\n}\n","/* eslint-disable import/prefer-default-export */\nimport React, { Component } from 'react'\nimport getWrappedDisplayName from './getWrappedDisplayName'\n\nexport default store => WrappedComponent => class extends Component {\n  static displayName = `provider(${getWrappedDisplayName(WrappedComponent)})`\n\n  static childContextTypes = {\n    store: () => null, // this is to avoid importing prop-types\n  }\n\n  getChildContext() {\n    return { store }\n  }\n\n  componentWillMount() {\n    store.dispatch('@@krml/INIT')\n  }\n\n  render() {\n    return <WrappedComponent {...this.props} />\n  }\n}\n","import React, { Component } from 'react'\nimport getWrappedDisplayName from './getWrappedDisplayName'\n\nconst defaultListeners = []\n\nconst toActionFactory = (name) => {\n  const suffix = `${name ? '>' : ''}${name || ''}`\n  return type => `@@krml/LISTENERS>${type}${suffix}`\n}\n\nexport default (listeners = defaultListeners, name) => (WrappedComponent) => {\n  const toAction = toActionFactory(name)\n\n  return class extends Component {\n    static displayName = `listen(${getWrappedDisplayName(WrappedComponent)}`\n\n    static contextTypes = {\n      store: () => null, // this is to avoid importing prop-types\n    }\n\n    componentWillMount() {\n      const { store } = this.context\n\n      store.listeners.add(listeners)\n      store.dispatch(toAction('ADDED'))\n    }\n\n    componentWillUnmount() {\n      const { store } = this.context\n\n      store.dispatch(toAction('REMOVING'))\n      store.listeners.remove(listeners)\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />\n    }\n  }\n}\n"],"names":["Component","displayName","name","constructor","defaultObject","withoutFunctions","Object","keys","object","reduce","acc","key","value","props","context","inject","nextProps","store","setState","state","injectedProps","injectFunction","drivers","first","bold","console","error","getWrappedDisplayName","WrappedComponent","unsubscribe","subscribe","nextState","shallowEqual","undefined","React","contextTypes","dispatch","childContextTypes","defaultListeners","toActionFactory","suffix","type","listeners","toAction","add","remove"],"mappings":"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"}