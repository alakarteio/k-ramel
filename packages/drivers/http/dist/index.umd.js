!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@k-ramel/driver-http"]=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),o.forEach(function(e){n(t,e,r[e])})}return t}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a=function(t){return function(e,n){return function(r){return function(o,i,a,u,c){return t.dispatch({type:"@@http/".concat(e,">").concat(r,">").concat(o),payload:i,status:a,headers:u,fetch:c,context:n})}}}},u=function(u){var c={},s=function(s,f){var l=function(){var t,l=(t=regeneratorRuntime.mark(function t(e){var l,p,y,d,h,b,v,m,g,A,O,w,E,T,j,x=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(l=x.length>1&&void 0!==x[1]?x[1]:{},p=l.method,y=void 0===p?"GET":p,d=r({},c.headers,l.headers),h=r({},c,l,{headers:d}),b=a(u)(s,f)(y),A=x.length,O=new Array(A>2?A-2:0),w=2;w<A;w++)O[w-2]=x[w];return E=[e,h].concat(O),b("STARTED",void 0,void 0,void 0,E),t.prev=8,t.next=11,(T=global||window).fetch.apply(T,i(E));case 11:if(m=t.sent,v=m,D=m.headers.entries(),g=Object.assign.apply(Object,[{}].concat(i(Array.from(D,function(t){var e=o(t,2);return n({},e[0],e[1])})))),!m.headers.has("Content-Disposition")){t.next=22;break}return t.next=17,m.blob();case 17:t.t0=t.sent,t.t1=(S=m.headers.get("Content-Disposition"),/filename="(.*)"/g.exec(S)[1]),v={blob:t.t0,filename:t.t1},t.next=26;break;case 22:if(!m.headers.has("Content-Type")||!m.headers.get("Content-Type").includes("json")){t.next=26;break}return t.next=25,m.json();case 25:v=t.sent;case 26:t.next=32;break;case 28:return t.prev=28,t.t2=t.catch(8),b("FAILED",t.t2,(m||{}).status,g,E),t.abrupt("return",t.t2);case 32:return j=m.status,b(j>=400||j<200?"FAILED":"ENDED",v,j,g),t.abrupt("return",v);case 35:case"end":return t.stop()}var S,D},t,this,[[8,28]])}),function(){var n=this,r=arguments;return new Promise(function(o,i){var a=t.apply(n,r);function u(t){e(a,o,i,u,c,"next",t)}function c(t){e(a,o,i,u,c,"throw",t)}u(void 0)})});return function(t){return l.apply(this,arguments)}}();return["GET","POST","HEAD","PATCH","PUT","DELETE","OPTIONS","CONNECT"].forEach(function(e){l[e.toLowerCase()]=function(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r({},i.headers),u=i;if(o&&["object","array"].includes(t(o))){var c=o;o instanceof FormData||(a["Content-Type"]=a["Content-Type"]||"application/json",c=JSON.stringify(o)),u=r({},u,{body:c})}return u=r({},u,{method:e,headers:a}),l(n,u)}}),l};return s.setCredentials=function(t){c=r({},c,{credentials:t})},s.setOptions=function(t){c=r({},t,{headers:r({},t.headers)})},s.setAuthorization=function(t){var e=r({},c.headers,{Authorization:t});return t||delete e.Authorization,s.setOptions(r({},c,{headers:e}))},s.clearAuthorization=function(){return s.setAuthorization()},s};return function(){return{getDriver:u}}});
