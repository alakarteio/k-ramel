!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@k-ramel/driver-http"]=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),o.forEach(function(e){n(t,e,r[e])})}return t}function o(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(t){return function(e,n){return function(r){return function(o,i,a,u){return t.dispatch({type:"@@http/".concat(e,">").concat(r,">").concat(o),payload:i,status:a,fetch:u,context:n})}}}},a=function(n){var a={},u=function(u,c){var f=function(){var t,f=(t=regeneratorRuntime.mark(function t(e){var f,s,p,l,y,d,h,b,v,m,g,O,A,w,E=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(f=E.length>1&&void 0!==E[1]?E[1]:{},s=f.method,p=void 0===s?"GET":s,l=r({},a.headers,f.headers),y=r({},a,f,{headers:l}),d=i(n)(u,c)(p),v=E.length,m=new Array(v>2?v-2:0),g=2;g<v;g++)m[g-2]=E[g];return O=[e,y].concat(m),d("STARTED",void 0,void 0,O),t.prev=8,t.next=11,(A=global||window).fetch.apply(A,o(O));case 11:if(b=t.sent,h=b,!(b.headers&&b.headers.get("Content-Type")&&b.headers.get("Content-Type").includes("json"))){t.next=17;break}return t.next=16,b.json();case 16:h=t.sent;case 17:t.next=23;break;case 19:return t.prev=19,t.t0=t.catch(8),d("FAILED",t.t0,(b||{}).status,O),t.abrupt("return",t.t0);case 23:return w=b.status,d(w>=400||w<200?"FAILED":"ENDED",h,w),t.abrupt("return",h);case 26:case"end":return t.stop()}},t,this,[[8,19]])}),function(){var n=this,r=arguments;return new Promise(function(o,i){var a=t.apply(n,r);function u(t){e(a,o,i,u,c,"next",t)}function c(t){e(a,o,i,u,c,"throw",t)}u(void 0)})});return function(t){return f.apply(this,arguments)}}();return["GET","POST","HEAD","PATCH","PUT","DELETE","OPTIONS","CONNECT"].forEach(function(e){f[e.toLowerCase()]=function(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r({},i.headers),u=i;if(o&&["object","array"].includes(t(o))){var c=o;o instanceof FormData||(a["Content-Type"]=a["Content-Type"]||"application/json",c=JSON.stringify(o)),u=r({},u,{body:c})}return u=r({},u,{method:e,headers:a}),f(n,u)}}),f};return u.setCredentials=function(t){a=r({},a,{credentials:t})},u.setOptions=function(t){a=r({},t,{headers:r({},t.headers)})},u.setAuthorization=function(t){var e=r({},a.headers,{Authorization:t});return t||delete e.Authorization,u.setOptions(r({},a,{headers:e}))},u.clearAuthorization=function(){return u.setAuthorization()},u};return function(){return{getDriver:a}}});
