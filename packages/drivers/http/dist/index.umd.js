!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@k-ramel/driver-http"]=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(o,!0).forEach(function(r){e(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(o).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(t){return function(e,r){return function(n){return function(o,a,i,c,u){return t.dispatch({type:"@@http/".concat(e,">").concat(n,">").concat(o),payload:a,status:i,headers:c,fetch:u,context:r})}}}},c=function(r){var c={},u=function(u,s){var f=function(t){var f,l,p,y,d,b,h,m,v,g,O,j,w,A,E,S=arguments;return regeneratorRuntime.async(function(T){for(;;)switch(T.prev=T.next){case 0:for(f=S.length>1&&void 0!==S[1]?S[1]:{},l=f.method,p=void 0===l?"GET":l,y=n({},c.headers,{},f.headers),d=n({},c,{},f,{headers:y}),b=i(r)(u,s)(p),g=S.length,O=new Array(g>2?g-2:0),j=2;j<g;j++)O[j-2]=S[j];return w=[t,d].concat(O),b("STARTED",void 0,void 0,void 0,w),T.prev=8,T.next=11,regeneratorRuntime.awrap((A=global||window).fetch.apply(A,a(w)));case 11:if(m=T.sent,h=m,x=m.headers.entries(),v=Object.assign.apply(Object,[{}].concat(a(Array.from(x,function(t){var r=o(t,2);return e({},r[0],r[1])})))),!m.headers.has("Content-Disposition")){T.next=22;break}return T.next=17,regeneratorRuntime.awrap(m.blob());case 17:T.t0=T.sent,T.t1=(D=m.headers.get("Content-Disposition"),/filename="(.*)"/g.exec(D)[1]),h={blob:T.t0,filename:T.t1},T.next=26;break;case 22:if(!m.headers.has("Content-Type")||!m.headers.get("Content-Type").includes("json")){T.next=26;break}return T.next=25,regeneratorRuntime.awrap(m.json());case 25:h=T.sent;case 26:T.next=32;break;case 28:return T.prev=28,T.t2=T.catch(8),b("FAILED",T.t2,(m||{}).status,v,w),T.abrupt("return",T.t2);case 32:return E=m.status,b(E>=400||E<200?"FAILED":"ENDED",h,E,v),T.abrupt("return",h);case 35:case"end":return T.stop()}var D,x},null,null,[[8,28]])};return["GET","POST","HEAD","PATCH","PUT","DELETE","OPTIONS","CONNECT"].forEach(function(e){f[e.toLowerCase()]=function(r,o){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n({},a.headers),c=a;if(o&&["object","array"].includes(t(o))){var u=o;o instanceof FormData||(i["Content-Type"]=i["Content-Type"]||"application/json",u=JSON.stringify(o)),c=n({},c,{body:u})}return c=n({},c,{method:e,headers:i}),f(r,c)}}),f};return u.setCredentials=function(t){c=n({},c,{credentials:t})},u.setOptions=function(t){c=n({},t,{headers:n({},t.headers)})},u.setAuthorization=function(t){var e=n({},c.headers,{Authorization:t});return t||delete e.Authorization,u.setOptions(n({},c,{headers:e}))},u.clearAuthorization=function(){return u.setAuthorization()},u};return function(){return{getDriver:c}}});
