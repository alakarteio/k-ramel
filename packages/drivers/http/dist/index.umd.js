!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["@k-ramel/driver-http"]=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(t){return function(e,r){return function(n){return function(o,i,a,c,u){return t.dispatch({type:"@@http/".concat(e,">").concat(n,">").concat(o),payload:i,status:a,headers:c,fetch:u,context:r})}}}},u=function(n){var u={},s=function(s,f){var l=function(){var t,l=(t=regeneratorRuntime.mark(function t(e){var l,p,y,d,h,b,v,m,O,g,j,w,A,E,S,T=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(l=T.length>1&&void 0!==T[1]?T[1]:{},p=l.method,y=void 0===p?"GET":p,d=o({},u.headers,{},l.headers),h=o({},u,{},l,{headers:d}),b=c(n)(s,f)(y),g=T.length,j=new Array(g>2?g-2:0),w=2;w<g;w++)j[w-2]=T[w];return A=[e,h].concat(j),b("STARTED",void 0,void 0,void 0,A),t.prev=8,t.next=11,(E=global||window).fetch.apply(E,a(A));case 11:if(m=t.sent,v=m,P=m.headers.entries(),O=Object.assign.apply(Object,[{}].concat(a(Array.from(P,function(t){var e=i(t,2);return r({},e[0],e[1])})))),!m.headers.has("Content-Disposition")){t.next=22;break}return t.next=17,m.blob();case 17:t.t0=t.sent,t.t1=(D=m.headers.get("Content-Disposition"),/filename="(.*)"/g.exec(D)[1]),v={blob:t.t0,filename:t.t1},t.next=26;break;case 22:if(!m.headers.has("Content-Type")||!m.headers.get("Content-Type").includes("json")){t.next=26;break}return t.next=25,m.json();case 25:v=t.sent;case 26:t.next=32;break;case 28:return t.prev=28,t.t2=t.catch(8),b("FAILED",t.t2,(m||{}).status,O,A),t.abrupt("return",t.t2);case 32:return S=m.status,b(S>=400||S<200?"FAILED":"ENDED",v,S,O),t.abrupt("return",v);case 35:case"end":return t.stop()}var D,P},t,null,[[8,28]])}),function(){var r=this,n=arguments;return new Promise(function(o,i){var a=t.apply(r,n);function c(t){e(a,o,i,c,u,"next",t)}function u(t){e(a,o,i,c,u,"throw",t)}c(void 0)})});return function(t){return l.apply(this,arguments)}}();return["GET","POST","HEAD","PATCH","PUT","DELETE","OPTIONS","CONNECT"].forEach(function(e){l[e.toLowerCase()]=function(r,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o({},i.headers),c=i;if(n&&["object","array"].includes(t(n))){var u=n;n instanceof FormData||(a["Content-Type"]=a["Content-Type"]||"application/json",u=JSON.stringify(n)),c=o({},c,{body:u})}return c=o({},c,{method:e,headers:a}),l(r,c)}}),l};return s.setCredentials=function(t){u=o({},u,{credentials:t})},s.setOptions=function(t){u=o({},t,{headers:o({},t.headers)})},s.setAuthorization=function(t){var e=o({},u.headers,{Authorization:t});return t||delete e.Authorization,s.setOptions(o({},u,{headers:e}))},s.clearAuthorization=function(){return s.setAuthorization()},s};return function(){return{getDriver:u}}});
