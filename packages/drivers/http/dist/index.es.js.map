{"version":3,"file":"index.es.js","sources":["../src/http.js"],"sourcesContent":["const dispatchFactory = store => name => method =>\n  (event, payload, status, fetch) => store.dispatch({\n    type: `@@http/${name}>${method}>${event}`,\n    payload,\n    status,\n    fetch,\n  })\n\nexport default (store) => {\n  const innerHeaders = {}\n  let innerOptions = {}\n\n  const driver = (name) => {\n    const ownFetch = async (url, options = {}, ...args) => {\n      // options\n      const { method = 'GET' } = options\n      const appliedHeaders = { ...innerOptions.headers, ...innerHeaders, ...options.headers }\n      const appliedOptions = { ...innerOptions, ...options, headers: appliedHeaders }\n\n      // dispatcher\n      const dispatch = dispatchFactory(store)(name)(method)\n\n      // request\n      let data\n      let raw\n      const fetchArgs = [url, appliedOptions, ...args]\n      dispatch('STARTED', undefined, undefined, fetchArgs)\n      try {\n        raw = await (global || window).fetch(...fetchArgs)\n        data = raw\n\n        if (raw.headers && raw.headers.get('Content-Type') && raw.headers.get('Content-Type').includes('json')) {\n          data = await raw.json()\n        }\n      } catch (ex) {\n        dispatch('FAILED', ex, (raw || {}).status, fetchArgs)\n        return ex\n      }\n\n      const { status } = raw\n      if (status >= 400 || status < 200) {\n        dispatch('FAILED', data, status)\n      } else {\n        dispatch('ENDED', data, status)\n      }\n\n      return data\n    }\n\n    // methods helpers\n    ['GET', 'POST', 'HEAD', 'PUT', 'DELETE', 'OPTIONS', 'CONNECT']\n      .forEach((method) => {\n        ownFetch[method.toLowerCase()] = (url, data, options = {}) => {\n          const { headers = {} } = options\n          let appliedOptions = options\n\n          // attach data as JSON object\n          if (data && ['object', 'array'].includes(typeof data)) {\n            if (!headers['Content-Type']) appliedOptions = { ...appliedOptions, headers: { ...headers, 'Content-Type': 'application/json' } }\n\n            appliedOptions = { ...appliedOptions, body: JSON.stringify(data) }\n          }\n\n          // set method\n          appliedOptions = { ...appliedOptions, method }\n\n          return ownFetch(url, appliedOptions)\n        }\n      })\n\n    return ownFetch\n  }\n\n  // custom helpers\n  driver.setAuthorization = (authorization) => { innerHeaders.Authorization = authorization }\n  driver.setOptions = (options) => { innerOptions = options }\n  driver.setCredentials = (credentials) => { innerOptions = { ...innerOptions, credentials } }\n\n  return driver\n}\n"],"names":["dispatchFactory","event","payload","status","fetch","store","dispatch","name","method","innerHeaders","innerOptions","driver","ownFetch","url","args","options","headers","appliedHeaders","appliedOptions","undefined","fetchArgs","global","window","raw","get","includes","json","data","forEach","toLowerCase","body","JSON","stringify","setAuthorization","authorization","Authorization","setOptions","setCredentials","credentials"],"mappings":"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"}