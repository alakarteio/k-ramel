{"version":3,"file":"index.umd.js","sources":["../src/http.js"],"sourcesContent":["const dispatchFactory = store => name => method =>\n  (event, payload, status, fetch) => store.dispatch({\n    type: `@@http/${name}>${method}>${event}`,\n    payload,\n    status,\n    fetch,\n  })\n\nconst getDriver = (store) => {\n  let innerOptions = {}\n\n  const driver = (name) => {\n    const ownFetch = async (url, options = {}, ...args) => {\n      // options\n      const { method = 'GET' } = options\n      const appliedHeaders = { ...innerOptions.headers, ...options.headers }\n      const appliedOptions = { ...innerOptions, ...options, headers: appliedHeaders }\n      // dispatcher\n      const dispatch = dispatchFactory(store)(name)(method)\n\n      // request\n      let data\n      let raw\n      const fetchArgs = [url, appliedOptions, ...args]\n      dispatch('STARTED', undefined, undefined, fetchArgs)\n      try {\n        raw = await (global || window).fetch(...fetchArgs)\n        data = raw\n\n        if (raw.headers && raw.headers.get('Content-Type') && raw.headers.get('Content-Type').includes('json')) {\n          data = await raw.json()\n        }\n      } catch (ex) {\n        dispatch('FAILED', ex, (raw || {}).status, fetchArgs)\n        return ex\n      }\n\n      const { status } = raw\n      if (status >= 400 || status < 200) {\n        dispatch('FAILED', data, status)\n      } else {\n        dispatch('ENDED', data, status)\n      }\n\n      return data\n    }\n\n    // methods helpers\n    ['GET', 'POST', 'HEAD', 'PUT', 'DELETE', 'OPTIONS', 'CONNECT']\n      .forEach((method) => {\n        ownFetch[method.toLowerCase()] = (url, data, options = {}) => {\n          const headers = { ...options.headers }\n          let appliedOptions = options\n\n          if (data && ['object', 'array'].includes(typeof data)) {\n            // attach data as JSON object\n            let body = data\n            if (!(data instanceof FormData)) {\n              headers['Content-Type'] = headers['Content-Type'] || 'application/json'\n              body = JSON.stringify(data)\n            }\n            appliedOptions = { ...appliedOptions, body }\n          }\n\n          // set fetch arguments\n          appliedOptions = { ...appliedOptions, method, headers }\n\n          return ownFetch(url, appliedOptions)\n        }\n      })\n\n    return ownFetch\n  }\n\n  // custom helpers\n  driver.setCredentials = (credentials) => { innerOptions = { ...innerOptions, credentials } }\n  driver.setOptions = (options) => {\n    innerOptions = { ...options, headers: { ...options.headers } }\n  }\n  driver.setAuthorization = (authorization) => {\n    const headers = { ...innerOptions.headers, Authorization: authorization }\n    if (!authorization) delete headers.Authorization\n\n    return driver.setOptions({ ...innerOptions, headers })\n  }\n  driver.clearAuthorization = () => driver.setAuthorization()\n\n  return driver\n}\n\nexport default () => ({\n  getDriver,\n})\n"],"names":["dispatchFactory","event","payload","status","fetch","store","dispatch","type","name","method","getDriver","innerOptions","driver","ownFetch","url","args","options","appliedHeaders","headers","appliedOptions","data","raw","fetchArgs","undefined","global","window","get","includes","json","forEach","toLowerCase","body","FormData","JSON","stringify","setCredentials","credentials","setOptions","setAuthorization","authorization","Authorization","clearAuthorization"],"mappings":"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"}