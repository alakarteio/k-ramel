!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("k-redux-factory"),require("redux"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","k-redux-factory","redux","lodash"],t):t(e["k-ramel"]={},e["k-redux-factory"],e.Redux,e._)}(this,function(exports,factory,redux,lodash){"use strict";factory=factory&&factory.hasOwnProperty("default")?factory.default:factory;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}},defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},reduxFactory=function(root){var subtree=function subtree(name,path){if(void 0===name)return Object.keys(root).map(function(e){return defineProperty({},e,subtree(e,""))}).reduce(function(e,t){return _extends({},e,t)},{});var nextPath=(path?path+".":"")+name,fullpath="root."+nextPath,options=eval(fullpath),type=options.type;return type?factory(_extends({name:name,path:path,prefix:path&&path.replace(/\./g,"_")||""},options)):"function"==typeof options?options:Object.keys(options).map(function(e){return defineProperty({},e,subtree(e,nextPath))}).reduce(function(e,t){return _extends({},e,t)},{})};return subtree()},withParams=["get","getBy","hasKey"],keysConfig={keyValue:[["set","add","update","addOrUpdate","replace","remove","orderBy","reset"],["get","getBy","getKeys","getAsArray","getLength","isInitialized","getState","hasKey"]],simpleObject:[["set","update","reset"],["get","isInitialized"]]},toContext=function(root,store){var subcontext=function subcontext(name,path){if(void 0===name)return Object.keys(root).map(function(e){return defineProperty({},e,subcontext(e,""))}).reduce(function(e,t){return _extends({},e,t)},{});var nextPath=(path?path+".":"")+name,fullpath="root."+nextPath,reducer=eval(fullpath);if(void 0!==reducer.krfType){var keys=keysConfig[reducer.krfType],_keys=slicedToArray(keys,2),actions=_keys[0],selectors=_keys[1],actionsObject=actions.map(function(e){var t=reducer[e];return defineProperty({},e,function(){return store.dispatch(t.apply(void 0,arguments))})}).reduce(function(e,t){return _extends({},e,t)},{}),selectorsObject=selectors.map(function(e){var t=reducer[e];return defineProperty({},e,function(){return withParams.includes(e)?t.apply(void 0,arguments)(store.getState()):t(store.getState())})}).reduce(function(e,t){return _extends({},e,t)},{});return Object.assign(reducer,actionsObject,selectorsObject)}return Object.keys(reducer).map(function(e){return defineProperty({},e,subcontext(e,nextPath))}).reduce(function(e,t){return _extends({},e,t)},{})};return subcontext()},combine=function(e){return function e(t){var r=Object.keys(t).map(function(r){var n=t[r];return defineProperty({},r,"function"==typeof n?n:e(n))}).reduce(function(e,t){return _extends({},e,t)},{});return redux.combineReducers(r)}(e)},getReduxDevToolsEnhancer=function(e){return window.devToolsExtension({name:e})},addDevTools=function(e){var t=e.name,r=e.devtools,n=e.enhancer;if(!r||!window||!window.devToolsExtension)return n;var o=getReduxDevToolsEnhancer(t);return n?redux.compose(n,o):o},listenFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=void 0,n=void 0,o=[e];return{setStore:function(e){r=e,n=Object.keys(t).reduce(function(r,n){return _extends({},r,defineProperty({},n,t[n](e)))},{})},addListeners:function(e){o=[].concat(toConsumableArray(o),[e])},removeListeners:function(e){o=o.filter(function(t){return t!==e})},middleware:function(){return function(e){return function(t){var i=e(t);return o.forEach(function(e){e.forEach(function(e){e(t,r,n)})}),i}}}}},enhanceRedux=function(e){var t=e.listeners,r=e.drivers,n=e.enhancer;n=addDevTools(e);var o=listenFactory(t,r),i=redux.applyMiddleware(o.middleware);return n?{enhancer:redux.compose(i,n),listen:o}:{enhancer:i,listen:o}},_this=void 0,dispatchFactory=function(e){return function(t){return function(r){return function(n,o,i){return e.dispatch({type:"@@http/"+t+">"+r+">"+n,payload:o,status:i})}}}},http=function(e){var t={},r=function(r){var n,o=(n=asyncToGenerator(regeneratorRuntime.mark(function n(o){for(var i=arguments.length,a=Array(i>2?i-2:0),u=2;u<i;u++)a[u-2]=arguments[u];var c,s,d,f,p,y,l,h,v,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=x.method,s=void 0===c?"GET":c,d=_extends({},t,x.headers),f=_extends({},x,{headers:d}),p=dispatchFactory(e)(r)(s),y=void 0,l=void 0,p("STARTED"),n.prev=7,n.next=10,(h=global||window).fetch.apply(h,[o,f].concat(toConsumableArray(a)));case 10:if(l=n.sent,y=l,!(l.headers&&l.headers.get("Content-Type")&&l.headers.get("Content-Type").includes("json"))){n.next=16;break}return n.next=15,l.json();case 15:y=n.sent;case 16:n.next=22;break;case 18:return n.prev=18,n.t0=n.catch(7),p("FAILED",n.t0,(l||{}).status),n.abrupt("return",n.t0);case 22:return v=l.status,p(v>=400||v<200?"FAILED":"ENDED",y,v),n.abrupt("return",y);case 25:case"end":return n.stop()}},n,_this,[[7,18]])})),function(e){return n.apply(this,arguments)});return["GET","POST","HEAD","PUT","DELETE","OPTIONS","CONNECT"].forEach(function(e){o[e.toLowerCase()]=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.headers,a=void 0===i?{}:i,u=n;return r&&["object","array"].includes(void 0===r?"undefined":_typeof(r))&&(a["Content-Type"]||(u=_extends({},u,{headers:_extends({},a,{"Content-Type":"application/json"})})),u=_extends({},u,{body:JSON.stringify(r)})),u=_extends({},u,{method:e}),o(t,u)}}),o};return r.setAuthorization=function(e){t.Authorization=e},r},drivers={http:http},defaultOptions={hideRedux:!0,enhancer:void 0,init:{},listeners:void 0,devtools:!0,name:"store",drivers:drivers},createStore=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:defaultOptions,r=_extends({},defaultOptions,t,{drivers:_extends({},defaultOptions.drivers,t.drivers)}),n=r.init,o=r.hideRedux,i=reduxFactory(e),a=enhanceRedux(r),u=a.enhancer,c=a.listen,s=redux.createStore(combine(i),n,u);o&&(i=toContext(i,s));var d=_extends({},i,s,{listeners:{add:c.addListeners,remove:c.removeListeners}}),f=d.dispatch;return d.dispatch=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"string"==typeof e?f({type:e}):f.apply(void 0,[e].concat(r))},c.setStore(d),d},keyValue=function(e){return _extends({},e,{type:"keyValue"})},simpleObject=function(e){return _extends({},e,{type:"simpleObject"})},isMatching=function(e,t){return function(r){return lodash.isString(r)&&e.type===r||lodash.isFunction(r)&&r(e,t)||lodash.isRegExp(r)&&e.type.match(r)}},_when=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(r,n,o){return!!t.map(isMatching(r,n)).reduce(function(e,t){return e&&t},!0)&&e(r,n,o)}}},reaction=function(e){return Object.assign(e,{when:function(){return _when.apply(void 0,arguments)(e)}})},reactions=function(e){return Object.keys(e).reduce(function(t,r){return _extends({},t,defineProperty({},r,reaction(e[r])))},{})};exports.applyMiddleware=redux.applyMiddleware,exports.compose=redux.compose,exports.createStore=createStore,exports.keyValue=keyValue,exports.simpleObject=simpleObject,exports.when=_when,exports.reaction=reaction,exports.reactions=reactions,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
